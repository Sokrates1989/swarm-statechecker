
  # Statechecker Check Service (background checker)
  check:
    image: ${IMAGE_NAME}:${IMAGE_VERSION}
    environment:
      # Logging.
      - TIMEZONE=${TIMEZONE}
      # Debug settings.
      - DEBUG_ENABLED=${DEBUG_ENABLED:-false}
      # Tools API tolerance period.
      - TOOLS_USING_API_TOLERANCE_PERIOD_IN_SECONDS=${TOOLS_USING_API_TOLERANCE_PERIOD_IN_SECONDS:-100}
      # Check Frequency.
      - CHECK_WEBSITES_EVERY_X_MINUTES=${CHECK_WEBSITES_EVERY_X_MINUTES}
      - CHECK_GOOGLEDRIVE_EVERY_X_MINUTES=${CHECK_GOOGLEDRIVE_EVERY_X_MINUTES}
      # Database connection.
      - DB_HOST=${STACK_NAME}_db
      - DB_USER=state_checker
      - DB_PW_FILE=/run/secrets/STATECHECKER_SERVER_DB_USER_PW
      - DB_NAME=state_checker
      # Initial data seeding (only used on first startup if database is empty).
      - INIT_WEBSITES=${INIT_WEBSITES:-}
      - INIT_GOOGLE_DRIVE_FOLDERS=${INIT_GOOGLE_DRIVE_FOLDERS:-}
      # Google Drive Backup check.
      - GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON_FILE=/run/secrets/STATECHECKER_SERVER_GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON
      ## Messaging ##
      - STATUS_MESSAGES_TIME_OFFSET_PERCENTAGE=${STATUS_MESSAGES_TIME_OFFSET_PERCENTAGE}
      # Email.
      - EMAIL_ENABLED=${EMAIL_ENABLED}
      - EMAIL_SENDER_USER=${EMAIL_SENDER_USER}
      - EMAIL_SENDER_PASSWORD_FILE=/run/secrets/STATECHECKER_SERVER_EMAIL_SENDER_PASSWORD
      - EMAIL_SENDER_PASSWORD=${EMAIL_SENDER_PASSWORD}
      - EMAIL_SENDER_HOST=${EMAIL_SENDER_HOST}
      - EMAIL_SENDER_PORT=${EMAIL_SENDER_PORT}
      - EMAIL_RECIPIENTS_ERROR=${EMAIL_RECIPIENTS_ERROR}
      - EMAIL_RECIPIENTS_INFORMATION=${EMAIL_RECIPIENTS_INFORMATION}
      # Telegram.
      - TELEGRAM_ENABLED=${TELEGRAM_ENABLED}
      - TELEGRAM_STATUS_MESSAGES_EVERY_X_MINUTES=${TELEGRAM_STATUS_MESSAGES_EVERY_X_MINUTES}
      - TELEGRAM_SENDER_BOT_TOKEN_FILE=/run/secrets/STATECHECKER_SERVER_TELEGRAM_SENDER_BOT_TOKEN
      - TELEGRAM_SENDER_BOT_TOKEN=${TELEGRAM_SENDER_BOT_TOKEN}
      - TELEGRAM_RECIPIENTS_ERROR_CHAT_IDS=${TELEGRAM_RECIPIENTS_ERROR_CHAT_IDS}
      - TELEGRAM_RECIPIENTS_INFO_CHAT_IDS=${TELEGRAM_RECIPIENTS_INFO_CHAT_IDS}
    secrets:
      - STATECHECKER_SERVER_DB_USER_PW
      - STATECHECKER_SERVER_GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON
      - STATECHECKER_SERVER_TELEGRAM_SENDER_BOT_TOKEN
      - STATECHECKER_SERVER_EMAIL_SENDER_PASSWORD
    networks:
      - backend
    volumes:
      - ${DATA_ROOT}/logs/check:/code/logs
    deploy:
      mode: replicated
      replicas: ${CHECK_REPLICAS:-1}
    command: ["python", "src/check_tools.py"]

